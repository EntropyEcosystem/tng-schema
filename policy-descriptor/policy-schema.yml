---
$schema: "http://json-schema.org/draft-04/schema#"
title: "Policy Descriptor Schema"
version: 0.1
description: "The core schema for SONATA policy descriptors."

##
## Some definitions used later on.
##
definitions:
  time_units:
    enum:
      - "s"   # seconds
      - "m"   # minutes
      - "h"   # hours
      - "d"   # days
  aggregatin_function:
    enum:
      - "avg"   # average
      - "min"   # min
      - "max"   # max
  monitoring:
    type: "object"
    properties:
      name:
       description: "The name of the parameter to monitor. The name has to be supported by the service platform or the FSM."
       type: "string"
       pattern: "^[A-Za-z-_]+$"
      unit:
       description: "The unit used to monitor (or represent) the parameter."
       oneOf:
         - $ref: "#/definitions/general_units"
         - $ref: "#/definitions/memory_units"
         - $ref: "#/definitions/bandwidth_units"
         - $ref: "#/definitions/frequency_units"
      frequency:
        description: "The sample rate of the monitoring parameter."
        type: "number"
        minimum: 0
        exclusiveMinimum: true
      frequency_unit:
        description: "The unit of the sample frequency."
        $ref: "#/definitions/frequency_units"
        default: "Hz"
      command:
        description: "A command that is executed in order to perform custom monitoring."
        type: "string"
    required:
      - name
      - unit
    additionalProperties: false
    
    
##
## The actual document description.
##
type: "object"
properties:
  descriptor_schema:
    description: "Reference to the schema corresponding to the descriptor (e.g., URL or local path)."
    type: "string"
  name:
    description: "The name of the policy description."
    type: "string"
    pattern: "^[a-z0-9\\-_.]+$"
  description:
    description: "A longer description of the policy."
    type: "string"
  rules:
    description: "A list of Policy rules  used to compose this Policy."
    type: "array"
    items:
      description: "A rule of the current policy"
      type: "object"
      properties:
        name:
          description: "The name of the policy rule."
          type: "string"
        duration:
          description: "The duration the condtion has to be met before an event is fired."
          type: "number"
        duration_unit:
          description: "The unit of the durration."
          ref: "#/definitions/time_units"
        condition:
          description: "The condition, a boolean expression, that must be met to fire the event."
          type: "string"
        action:
          description: "A list of notifications that are fired when the condition is met."
          type: "array"
          items:
            type: "object"
            properties:
              name:
                description: "The description of the action"
                type: "string"
              type:
                description: "The type of the action that is send to the message bus."
                type: "string"
            required:
              - type
      required:
        - name
        - duration
        - condition
        - action
    uniqueItems: true
    minItems: 1
required:
  - descriptor_schema
  - name
  - rules
additionalProperties: false